{
    "variables": {
        "mirror": "http://mirrors.kernel.org/archlinux",
        "version": "{{isotime \"2006.01\"}}.01",
        "boot": "60s",
        "headless": "false",
        "quiet": "false"
    },

    "builders": [{
        "type": "virtualbox-iso",
        "guest_os_type": "ArchLinux_64",
        "guest_additions_mode": "disable",
        "iso_url": "{{user `mirror`}}/iso/{{user `version`}}/archlinux-{{user `version`}}-x86_64.iso",
        "iso_checksum_url": "{{user `mirror`}}/iso/{{user `version`}}/sha1sums.txt",
        "iso_checksum_type": "sha1",
        "headless": "{{user `headless`}}",
        "boot_command": [
            "<enter><wait{{user `boot`}}>",
            "echo PermitEmptyPasswords yes >> /etc/ssh/sshd_config<enter><wait>",
            "systemctl start sshd<enter><wait>"
        ],
        "ssh_timeout": "1m",
        "ssh_username": "root",
        "ssh_password": "",
        "shutdown_command": "systemctl poweroff"
    }],

    "provisioners": [{
        "type": "shell",
        "scripts": [
            "install/10-partition.sh",
            "install/20-format.sh",
            "install/30-mount.sh",
            "install/40-mirrors.sh",
            "install/50-install.sh",
            "install/60-fstab.sh"
        ],
        "environment_vars": ["quiet={{user `quiet`}}", "mirror={{user `mirror`}}"]
    }, {
        "type": "shell",
        "scripts": [
            "provision/10-locale.sh",
            "provision/20-network.sh",
            "provision/30-network.sh",
            "provision/40-bootloader.sh",
            "provision/50-user.sh",
            "provision/60-sudo.sh",
            "provision/70-ssh.sh",
            "provision/80-virtualbox.sh",
            "provision/90-pacman.sh"
        ],
        "environment_vars": ["quiet={{user `quiet`}}"],
        "execute_command": "cp '{{.Path}}' /mnt/tmp.sh && {{.Vars}} arch-chroot /mnt /tmp.sh && rm /mnt/tmp.sh"
    }],

    "post-processors": [{
        "type": "vagrant",
        "output": "archlinux-{{.Provider}}.box"
    }]
}
